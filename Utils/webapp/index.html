<html>
	<head>
		<title>Demo: a game engine</title>
        <link rel="stylesheet" href="assets/css/style.css">
		<script type="text/javascript" src="lib/jquery.js"></script>
        <script type="text/javascript" src="lib/jquery.tmpl.js"></script>


        <!-- Connector for CRIJO -->
        <script type="application/javascript" src="lib/connector.js"></script>
        <script type="application/javascript" src="lib/stomp.js"></script>
        <script type="application/javascript" src="lib/BusConnectorHQSW.js"></script>

		<script type="text/javascript">

            var url = 'ws://5.115.206.27:61614/stomp';
            var remoteActorName = 'server.map1';
            var connector;

            var login = "Jonathan";

            function canYouConfirmThisMove(id,x,y,dx,dy) {
                connector.send(remoteActorName, "@"+login+".moveConfirmed", "@server.map1.canIMove", [x,y,dx,dy,"@"+login+".moveConfirmed", "@"+login+".moveCanceled",id])
            }

            function onCommunicationEstablished() {

                connector.setChannelListener("connectionOK", function(message) {
                    initGame();
                    console.log("conection OK");
                })

                connector.setChannelListener("connectionKO", function(message) {
                    console.log("conection KO");
                })

                connector.setChannelListener("moveConfirmed", function(message) {
                    mapOfPlayers[message.args[2]].makeSingle(message.args[0],message.args[1]);
                    console.log("moveconfirmed");
                })

                connector.setChannelListener("moveCanceled", function(message) {
                    console.log("movecanceled");
                })

                connector.setChannelListener("movePlayer", function(message) {
                    console.log("moveplayer");
                })

                connector.send(remoteActorName, "@"+login+".connectionOK", "@server.map1.inscription", ["@"+login+".connectionOK", "@"+login+".in"])
            }

            $(document).ready(function(){

                connector = new Connector();
                connector.addConnectorEvent("connect", onCommunicationEstablished);
                connector.connect(url, login);
            })

		</script>

        <script type="text/x-jquery-tmpl" id="playerTemplate">
            <div id="player-${id}" class="player"></div>
        </script>

        <script type="text/javascript" src="lib/engine.js"></script>
	</head>
	<body>
        <div id="wrapper">
            <div id="background">
                <div id="scene">

                </div>
            </div>
            <div id="debug">
            </div>
        </div>
	</body>
</html>