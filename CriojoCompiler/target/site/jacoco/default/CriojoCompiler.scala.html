<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CriojoCompiler.scala</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">CRIOJO-compiler</a> &gt; <a href="index.html" class="el_package">default</a> &gt; <span class="el_source">CriojoCompiler.scala</span></div><h1>CriojoCompiler.scala</h1><pre class="source lang-java linenums">/**
 * Created by IntelliJ IDEA.
 * User: jonathan
 * Date: 5/10/12
 * Time: 5:25 PM
 * To change this template use File | Settings | File Templates.
 */

import collection.mutable.HashMap
import java.io.{BufferedWriter, FileWriter}
import util.parsing.combinator.JavaTokenParsers


<span class="nc" id="L14">class ProgramEnvironment {</span>
<span class="nc" id="L15">  var mapOfServers:HashMap[String, ServerEnvironment] = HashMap()</span>
}

<span class="nc" id="L18">class ServerEnvironment {</span>
<span class="nc" id="L19">  var mapOfChams:HashMap[String, ChamEnvironment] = HashMap()</span>
}

<span class="nc" id="L22">class ChamEnvironment {</span>
<span class="nc" id="L23">  var mapOfVariables:HashMap[String, String] = HashMap()</span>
<span class="nc" id="L24">  var mapOfInChannel:HashMap[String, String] = HashMap()</span>
<span class="nc" id="L25">  var mapOfOutChannel:HashMap[String, String] = HashMap()</span>
}

<span class="nc" id="L28">object CriojoCompiler {</span>
  def main(args: Array[String]) {

<span class="nc bnc" id="L31" title="All 2 branches missed.">    if(args.length &lt; 1) {</span>
<span class="nc" id="L32">      println(&quot;CriojoCompiler &lt;input file&gt; [output file]&quot;)</span>
    }
    else {
<span class="nc" id="L35">      val inputProgram = scala.io.Source.fromFile(args(0)).mkString</span>
<span class="nc" id="L36">      val s:String = new CriojoCompiler().parse(inputProgram)</span>

<span class="nc bnc" id="L38" title="All 2 branches missed.">      if(args.length &gt; 1) {</span>
<span class="nc" id="L39">        val fstream:FileWriter = new FileWriter(args(1));</span>
<span class="nc" id="L40">        val out:BufferedWriter = new BufferedWriter(fstream);</span>
<span class="nc" id="L41">        out.write(s);</span>
<span class="nc" id="L42">        out.close();</span>
      }
      else {
<span class="nc" id="L45">        println(s)</span>
      }
    }
  }
}

<span class="nc bnc" id="L51" title="All 20 branches missed.">class CriojoCompiler extends JavaTokenParsers {</span>


<span class="nc" id="L54">  var env:ProgramEnvironment = new ProgramEnvironment()</span>

<span class="nc" id="L56">  var currentChamEnvironment:ChamEnvironment = new ChamEnvironment()</span>
<span class="nc" id="L57">  var currentServerEnvironment:ServerEnvironment = new ServerEnvironment()</span>

<span class="nc" id="L59">  def parse(s:String):String = parseAll(program,s).get.toString</span>

<span class="nc" id="L61">  val fpt = floatingPointNumber</span>
<span class="nc" id="L62">  val id =  ident</span>
<span class="nc" id="L63">  val num = wholeNumber</span>
<span class="nc" id="L64">  val dec = decimalNumber</span>
<span class="nc" id="L65">  val str = stringLiteral</span>

<span class="nc bnc" id="L67" title="All 2 branches missed.">  def program: Parser[Any] = rep(server) ^^ {</span>
<span class="nc" id="L68">    case servers =&gt; ObjectToScala.mainProgram(servers)</span>
  }

<span class="nc bnc" id="L71" title="All 14 branches missed.">  def server: Parser[Any] = id~&quot;{&quot;~rep(cham)&lt;~&quot;}&quot; ^^ {</span>
<span class="nc" id="L72">    case idServer~_~chams =&gt; {</span>
<span class="nc" id="L73">      env.mapOfServers.put(idServer, currentServerEnvironment)</span>
<span class="nc" id="L74">      currentServerEnvironment = new ServerEnvironment()</span>
<span class="nc" id="L75">      ObjectToScala.serverWithVariableDeclariation(idServer, chams, env.mapOfServers.get(idServer).get)</span>
    }
  }

<span class="nc bnc" id="L79" title="All 14 branches missed.">  def cham: Parser[Any] = id~&quot;{&quot;~rep(rule)&lt;~&quot;}&quot; ^^ {</span>
<span class="nc" id="L80">    case idCham~_~rules =&gt; {</span>
<span class="nc" id="L81">      currentServerEnvironment.mapOfChams.put(idCham, currentChamEnvironment)</span>
<span class="nc" id="L82">      currentChamEnvironment = new ChamEnvironment()</span>
<span class="nc" id="L83">      ObjectToScala.chamWithVariableDeclariation(idCham, rules, currentServerEnvironment.mapOfChams.get(idCham).get)</span>
    }
  }

<span class="nc bnc" id="L87" title="All 8 branches missed.">  def rule: Parser[Any] = atoms~&quot;-&gt;&quot;~atoms ^^ {</span>
<span class="nc" id="L88">    case atomsLeft~_~atomsRight =&gt; ObjectToScala.rule(atomsLeft, atomsRight)</span>
  }

<span class="nc bnc" id="L91" title="All 4 branches missed.">  def atoms: Parser[List[Any]] = repsep(atom, &quot;,&quot;)</span>

<span class="nc bnc" id="L93" title="All 12 branches missed.">  def atom: Parser[Any] = criojoId~&quot;(&quot;~exps~&quot;)&quot; ^^ {</span>
<span class="nc" id="L94">    case idAtom~_~expressions~_ =&gt; idAtom+&quot;(&quot;+ObjectToScala.arguments(expressions)+&quot;)&quot;</span>
  }
  
<span class="nc bnc" id="L97" title="All 4 branches missed.">  def exps: Parser[List[Any]] = repsep(exp, &quot;,&quot;)</span>
<span class="nc bnc" id="L98" title="All 8 branches missed.">  def exp: Parser[Any] = fpt | str | dec | criojoId | num</span>
  
  
<span class="nc bnc" id="L101" title="All 8 branches missed.">  def criojoId = remoteChamdId | localChamdId | inChannelId | id ^^ { case idVar =&gt; {</span>
<span class="nc" id="L102">      currentChamEnvironment.mapOfVariables.put(idVar, &quot;:LocalRelation = new LocalRelation(\&quot;&quot;+idVar+&quot;\&quot;)&quot;)</span>
<span class="nc" id="L103">      idVar</span>
    }

  }

<span class="nc bnc" id="L108" title="All 6 branches missed.">  def inChannelId: Parser[Any] = &quot;@&quot;~id ^^ { case _~atomName =&gt; {</span>
<span class="nc" id="L109">    currentChamEnvironment.mapOfInChannel.put(atomName, &quot;:InChannel = InChannel(\&quot;&quot;+atomName+&quot;\&quot;)&quot;)</span>
<span class="nc" id="L110">    atomName</span>
  }
  }
<span class="nc bnc" id="L113" title="All 10 branches missed.">  def localChamdId: Parser[Any] = id~&quot;.&quot;~id ^^ { case chamName~_~atomName =&gt; {</span>
<span class="nc" id="L114">      currentChamEnvironment.mapOfOutChannel.put(chamName+&quot;To&quot;+atomName, &quot;:OutChannel = OutChannel(\&quot;&quot;+chamName+&quot;.&quot;+atomName+&quot;\&quot;)&quot;)</span>
<span class="nc" id="L115">      &quot;@&quot;+chamName+&quot;.&quot;+atomName</span>
    }
  }
<span class="nc bnc" id="L118" title="All 24 branches missed.">  def remoteChamdId: Parser[Any] = id~&quot;.&quot;~id~&quot;.&quot;~id ^^ { case serverName~_~chamName~&quot;.&quot;~atomName =&gt; {</span>
<span class="nc" id="L119">      currentChamEnvironment.mapOfOutChannel.put(chamName+&quot;At&quot;+serverName+&quot;To&quot;+atomName, &quot;:OutChannel = OutChannel(\&quot;&quot;+serverName+&quot;.&quot;+chamName+&quot;.&quot;+atomName+&quot;\&quot;)&quot;)</span>
<span class="nc" id="L120">      &quot;@&quot;+serverName+&quot;.&quot;+chamName+&quot;.&quot;+atomName</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://jacoco.org">JaCoCo</a> 0.5.3.201107060350</span></div></body></html>